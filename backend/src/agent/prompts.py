# =============================================================================
# LangGraph 智能研究代理 - 提示词模板模块
# =============================================================================
# 本文件定义了整个研究流程中使用的所有提示词模板，实现了：
# 1. 查询生成提示词：指导AI生成高质量搜索查询
# 2. 网络搜索提示词：指导AI进行有效的网络搜索
# 3. 反思评估提示词：指导AI评估研究完整性
# 4. 答案生成提示词：指导AI生成最终研究报告
# 5. 工具函数：提供日期等辅助信息
# =============================================================================

# 日期时间处理
from datetime import datetime


# =============================================================================
# 工具函数 - 日期获取
# =============================================================================
def get_current_date():
    """
    【获取当前日期】
    以可读格式返回当前日期，用于提示词中的时效性标注。
    
    返回:
        str: 格式化的日期字符串（如："December 15, 2024"）
    """
    return datetime.now().strftime("%B %d, %Y")


# =============================================================================
# 1. 查询生成提示词模板 - query_writer_instructions
# =============================================================================
# 用于指导AI根据用户问题生成高质量、多样化的搜索查询
# 确保查询的相关性、多样性和时效性
# =============================================================================
query_writer_instructions = """你的目标是生成精密且多样化的网络搜索查询。这些查询将用于高级自动化网络研究工具，该工具能够分析复杂结果、跟踪链接并综合信息。

指令说明：
- 优先使用单个搜索查询，只有当原始问题涉及多个方面或元素且一个查询不足以覆盖时才添加其他查询
- 每个查询应专注于原始问题的一个特定方面
- 不要生成超过 {number_queries} 个查询
- 查询应该多样化，如果主题广泛，生成多于1个查询
- 不要生成多个相似的查询，1个就足够了
- 查询应确保收集到最新信息。当前日期是 {current_date}

输出格式要求：
- 将响应格式化为包含以下两个确切键的JSON对象：
   - "rationale": 简要解释为什么这些查询与研究主题相关
   - "query": 搜索查询列表

示例：

主题：去年苹果股票收入增长更多还是购买iPhone的人数增长更多
```json
{{
    "rationale": "为了准确回答这个比较增长的问题，我们需要苹果股票表现和iPhone销售指标的具体数据点。这些查询针对所需的精确财务信息：公司收入趋势、产品特定单位销售数据，以及同一财政期间的股价变动，以便进行直接比较。",
    "query": ["苹果公司2024财年总收入增长", "iPhone 2024财年单位销售增长", "苹果股价2024财年增长"],
}}
```

研究背景: {research_topic}"""


# =============================================================================
# 2. 网络搜索提示词模板 - web_searcher_instructions
# =============================================================================
# 用于指导AI进行有针对性的Google搜索，收集最新、可信的信息
# 强调信息的准确性、时效性和可追溯性
# =============================================================================
web_searcher_instructions = """针对"{research_topic}"进行有针对性的Google搜索，收集最新、可信的信息，并将其综合为可验证的文本内容。

执行指令：
- 查询应确保收集到最新信息。当前日期是 {current_date}
- 进行多样化的搜索以收集全面信息
- 整合关键发现，同时细致跟踪每个具体信息的来源
- 输出应该是基于搜索发现的结构良好的摘要或报告
- 只包含在搜索结果中找到的信息，不要编造任何信息

研究主题：
{research_topic}
"""

# =============================================================================
# 3. 反思评估提示词模板 - reflection_instructions
# =============================================================================
# 用于指导AI评估当前研究的完整性，识别知识空白并生成后续查询
# 实现智能的自适应研究深化
# =============================================================================
reflection_instructions = """你是一位专业的研究助手，正在分析关于"{research_topic}"的研究摘要。

执行指令：
- 识别知识空白或需要深入探索的领域，并生成后续查询（1个或多个）
- 如果提供的摘要足以回答用户的问题，则不生成后续查询
- 如果存在知识空白，生成有助于扩展理解的后续查询
- 重点关注技术细节、实施具体信息或未充分涵盖的新兴趋势

输出要求：
- 确保后续查询是自包含的，包含网络搜索所需的必要上下文

输出格式：
- 将响应格式化为包含以下确切键的JSON对象：
   - "is_sufficient": true 或 false
   - "knowledge_gap": 描述缺失或需要澄清的信息
   - "follow_up_queries": 编写解决此空白的具体问题

示例：
```json
{{
    "is_sufficient": true, // 或 false
    "knowledge_gap": "摘要缺乏关于性能指标和基准测试的信息", // 如果 is_sufficient 为 true 则为 ""
    "follow_up_queries": ["用于评估[特定技术]的典型性能基准和指标是什么？"] // 如果 is_sufficient 为 true 则为 []
}}
```

请仔细反思摘要内容，识别知识空白并生成后续查询。然后按照此JSON格式输出：

研究摘要：
{summaries}
"""

# =============================================================================
# 4. 答案生成提示词模板 - answer_instructions
# =============================================================================
# 用于指导AI基于研究摘要生成全面、准确的最终答案
# 强调信息综合、结构化表达和来源引用
# =============================================================================
answer_instructions = """基于提供的研究摘要为用户问题生成高质量答案。

执行指令：
- 当前日期是 {current_date}
- 您是多步骤研究流程的最终环节，请不要提及您是最终步骤
- 您可以访问前面步骤收集的所有信息
- 您可以访问用户的问题
- 基于提供的摘要和用户问题生成高质量答案
- 必须在答案中正确包含摘要中使用的来源，使用markdown格式（例如：[apnews](https://vertexaisearch.cloud.google.com/id/1-0)）。这是必须的。

用户背景：
- {research_topic}

研究摘要：
{summaries}"""
